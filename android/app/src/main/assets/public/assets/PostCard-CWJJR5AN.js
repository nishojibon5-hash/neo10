const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Comments-DwdjivDr.js","assets/index-Cny3-YC3.js","assets/index-CzS1Ztlo.css","assets/Layout-63m88gTv.js","assets/button-vWn4QgZQ.js"])))=>i.map(i=>d[i]);
import{c as X,r as s,j as r,e as he,m as Ee,P as E,b as x,u as $,a as je,n as xe,o as ve,R as kt,A as Ot,p as De,q as re,t as Ft,v as Lt,D as $t,C as Gt,w as Kt,f as j,_ as Ut,L as Ne,h as Bt,g as zt}from"./index-Cny3-YC3.js";import{u as fe,h as Vt,c as Ht,R as Wt,F as Yt,A as Xt,a as qt,b as Jt,E as Zt,M as Qt}from"./Layout-63m88gTv.js";import{B as en}from"./button-vWn4QgZQ.js";const tn=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],nn=X("check",tn);const on=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],rn=X("chevron-right",on);const an=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],sn=X("circle",an);const cn=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],un=X("share-2",cn);const ln=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],dn=X("trash-2",ln),fn=["ðŸ˜†","ðŸ¥²","ðŸ«¦","ðŸ¥´","ðŸ˜¡","â™¥ï¸","ðŸ¤”","ðŸ˜®"];function pn({onPick:e}){return r.jsx("div",{className:"flex items-center gap-1 rounded-full bg-card border px-2 py-1 shadow-sm",children:fn.map(t=>r.jsx("button",{className:"text-xl leading-none hover:scale-110 transition",onClick:()=>e(t),"aria-label":`React ${t}`,children:t},t))})}function mn({postId:e,initialCount:t=0,initialReaction:n}){const[o,a]=s.useState(!1),[c,l]=s.useState(t),[u,m]=s.useState(n||null);let f=null;const d=async w=>{a(!1),m(w);try{const v=localStorage.getItem("token")||"",y=await fetch(`/api/posts/${e}/react`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:v?`Bearer ${v}`:""},body:JSON.stringify({type:w})});if(y.status===401){window.location.href="/login";return}y.ok&&(await y.json().catch(()=>({}))).created&&l(M=>(M||0)+1)}catch{}},i=()=>{clearTimeout(f),f=setTimeout(()=>a(!0),300)},h=()=>{o||(clearTimeout(f),d("â™¥ï¸"))};return r.jsxs("div",{className:"relative",onMouseLeave:()=>a(!1),children:[r.jsxs("button",{className:"flex items-center justify-center gap-2 py-2.5 hover:bg-muted/60 w-full",onMouseDown:i,onMouseUp:h,onTouchStart:i,onTouchEnd:h,children:[u||"Like"," ",c?`(${c})`:""]}),o&&r.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-full mt-1 z-20",children:r.jsx(pn,{onPick:d})})]})}function hn(){const[e,t]=s.useState(null);return s.useEffect(()=>{let n=!0;return(async()=>{try{const a=await fetch("/api/ads/active").catch(()=>null);if(!a||!a.ok){n&&t(null);return}const c=await a.json().catch(()=>({ad:null}));n&&(t(c.ad||null),c.ad?.id&&fetch(`/api/ads/${c.ad.id}/impression`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({placement:"post_inline"})}).catch(()=>{}))}catch{n&&t(null)}})(),()=>{n=!1}},[]),e?r.jsxs("div",{className:"mx-3 mb-3 rounded-lg border bg-muted/40 overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-xs text-muted-foreground border-b bg-card/60",children:[r.jsx("span",{className:"font-medium",children:"Sponsored"}),r.jsx("span",{children:"Ad"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_200px] gap-0",children:[r.jsxs("div",{className:"p-3 text-sm",children:[r.jsx("h4",{className:"font-semibold mb-1",children:e.title}),r.jsx("div",{className:"mt-2",children:e.destination_url?r.jsx("a",{href:e.destination_url,target:"_blank",rel:"noreferrer",children:r.jsx(en,{size:"sm",children:"Learn more"})}):null})]}),e.media_url?e.media_type==="video"?r.jsx("video",{src:e.media_url,className:"h-36 w-full object-cover",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,controls:!1}):r.jsx("img",{src:e.media_url,alt:e.title,className:"h-36 w-full object-cover"}):null]})]}):null}var xn=s.createContext(void 0);function Pe(e){const t=s.useContext(xn);return e||t||"ltr"}var de="rovingFocusGroup.onEntryFocus",vn={bubbles:!1,cancelable:!0},q="RovingFocusGroup",[pe,Te,gn]=Ee(q),[wn,Ae]=he(q,[gn]),[Mn,yn]=wn(q),ke=s.forwardRef((e,t)=>r.jsx(pe.Provider,{scope:e.__scopeRovingFocusGroup,children:r.jsx(pe.Slot,{scope:e.__scopeRovingFocusGroup,children:r.jsx(Cn,{...e,ref:t})})}));ke.displayName=q;var Cn=s.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:o,loop:a=!1,dir:c,currentTabStopId:l,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:m,onEntryFocus:f,preventScrollOnEntryFocus:d=!1,...i}=e,h=s.useRef(null),w=$(t,h),v=Pe(c),[y,g]=je({prop:l,defaultProp:u??null,onChange:m,caller:q}),[M,G]=s.useState(!1),_=xe(f),N=Te(n),K=s.useRef(!1),[Q,D]=s.useState(0);return s.useEffect(()=>{const C=h.current;if(C)return C.addEventListener(de,_),()=>C.removeEventListener(de,_)},[_]),r.jsx(Mn,{scope:n,orientation:o,dir:v,loop:a,currentTabStopId:y,onItemFocus:s.useCallback(C=>g(C),[g]),onItemShiftTab:s.useCallback(()=>G(!0),[]),onFocusableItemAdd:s.useCallback(()=>D(C=>C+1),[]),onFocusableItemRemove:s.useCallback(()=>D(C=>C-1),[]),children:r.jsx(E.div,{tabIndex:M||Q===0?-1:0,"data-orientation":o,...i,ref:w,style:{outline:"none",...e.style},onMouseDown:x(e.onMouseDown,()=>{K.current=!0}),onFocus:x(e.onFocus,C=>{const O=!K.current;if(C.target===C.currentTarget&&O&&!M){const P=new CustomEvent(de,vn);if(C.currentTarget.dispatchEvent(P),!P.defaultPrevented){const U=N().filter(S=>S.focusable),B=U.find(S=>S.active),ee=U.find(S=>S.id===y),ie=[B,ee,...U].filter(Boolean).map(S=>S.ref.current);Le(ie,d)}}K.current=!1}),onBlur:x(e.onBlur,()=>G(!1))})})}),Oe="RovingFocusGroupItem",Fe=s.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:o=!0,active:a=!1,tabStopId:c,children:l,...u}=e,m=fe(),f=c||m,d=yn(Oe,n),i=d.currentTabStopId===f,h=Te(n),{onFocusableItemAdd:w,onFocusableItemRemove:v,currentTabStopId:y}=d;return s.useEffect(()=>{if(o)return w(),()=>v()},[o,w,v]),r.jsx(pe.ItemSlot,{scope:n,id:f,focusable:o,active:a,children:r.jsx(E.span,{tabIndex:i?0:-1,"data-orientation":d.orientation,...u,ref:t,onMouseDown:x(e.onMouseDown,g=>{o?d.onItemFocus(f):g.preventDefault()}),onFocus:x(e.onFocus,()=>d.onItemFocus(f)),onKeyDown:x(e.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){d.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const M=Rn(g,d.orientation,d.dir);if(M!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let _=h().filter(N=>N.focusable).map(N=>N.ref.current);if(M==="last")_.reverse();else if(M==="prev"||M==="next"){M==="prev"&&_.reverse();const N=_.indexOf(g.currentTarget);_=d.loop?In(_,N+1):_.slice(N+1)}setTimeout(()=>Le(_))}}),children:typeof l=="function"?l({isCurrentTabStop:i,hasTabStop:y!=null}):l})})});Fe.displayName=Oe;var bn={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function _n(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Rn(e,t,n){const o=_n(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return bn[o]}function Le(e,t=!1){const n=document.activeElement;for(const o of e)if(o===n||(o.focus({preventScroll:t}),document.activeElement!==n))return}function In(e,t){return e.map((n,o)=>e[(t+o)%e.length])}var Nn=ke,Sn=Fe;function En(e){const t=jn(e),n=s.forwardRef((o,a)=>{const{children:c,...l}=o,u=s.Children.toArray(c),m=u.find(Pn);if(m){const f=m.props.children,d=u.map(i=>i===m?s.Children.count(f)>1?s.Children.only(null):s.isValidElement(f)?f.props.children:null:i);return r.jsx(t,{...l,ref:a,children:s.isValidElement(f)?s.cloneElement(f,void 0,d):null})}return r.jsx(t,{...l,ref:a,children:c})});return n.displayName=`${e}.Slot`,n}function jn(e){const t=s.forwardRef((n,o)=>{const{children:a,...c}=n;if(s.isValidElement(a)){const l=An(a),u=Tn(c,a.props);return a.type!==s.Fragment&&(u.ref=o?ve(o,l):l),s.cloneElement(a,u)}return s.Children.count(a)>1?s.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Dn=Symbol("radix.slottable");function Pn(e){return s.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Dn}function Tn(e,t){const n={...t};for(const o in t){const a=e[o],c=t[o];/^on[A-Z]/.test(o)?a&&c?n[o]=(...u)=>{const m=c(...u);return a(...u),m}:a&&(n[o]=a):o==="style"?n[o]={...a,...c}:o==="className"&&(n[o]=[a,c].filter(Boolean).join(" "))}return{...e,...n}}function An(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var me=["Enter"," "],kn=["ArrowDown","PageUp","Home"],$e=["ArrowUp","PageDown","End"],On=[...kn,...$e],Fn={ltr:[...me,"ArrowRight"],rtl:[...me,"ArrowLeft"]},Ln={ltr:["ArrowLeft"],rtl:["ArrowRight"]},J="Menu",[W,$n,Gn]=Ee(J),[A,Ge]=he(J,[Gn,De,Ae]),ae=De(),Ke=Ae(),[Kn,k]=A(J),[Un,Z]=A(J),Ue=e=>{const{__scopeMenu:t,open:n=!1,children:o,dir:a,onOpenChange:c,modal:l=!0}=e,u=ae(t),[m,f]=s.useState(null),d=s.useRef(!1),i=xe(c),h=Pe(a);return s.useEffect(()=>{const w=()=>{d.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>d.current=!1;return document.addEventListener("keydown",w,{capture:!0}),()=>{document.removeEventListener("keydown",w,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),r.jsx(kt,{...u,children:r.jsx(Kn,{scope:t,open:n,onOpenChange:i,content:m,onContentChange:f,children:r.jsx(Un,{scope:t,onClose:s.useCallback(()=>i(!1),[i]),isUsingKeyboardRef:d,dir:h,modal:l,children:o})})})};Ue.displayName=J;var Bn="MenuAnchor",ge=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,a=ae(n);return r.jsx(Ot,{...a,...o,ref:t})});ge.displayName=Bn;var we="MenuPortal",[zn,Be]=A(we,{forceMount:void 0}),ze=e=>{const{__scopeMenu:t,forceMount:n,children:o,container:a}=e,c=k(we,t);return r.jsx(zn,{scope:t,forceMount:n,children:r.jsx(re,{present:n||c.open,children:r.jsx(Ft,{asChild:!0,container:a,children:o})})})};ze.displayName=we;var I="MenuContent",[Vn,Me]=A(I),Ve=s.forwardRef((e,t)=>{const n=Be(I,e.__scopeMenu),{forceMount:o=n.forceMount,...a}=e,c=k(I,e.__scopeMenu),l=Z(I,e.__scopeMenu);return r.jsx(W.Provider,{scope:e.__scopeMenu,children:r.jsx(re,{present:o||c.open,children:r.jsx(W.Slot,{scope:e.__scopeMenu,children:l.modal?r.jsx(Hn,{...a,ref:t}):r.jsx(Wn,{...a,ref:t})})})})}),Hn=s.forwardRef((e,t)=>{const n=k(I,e.__scopeMenu),o=s.useRef(null),a=$(t,o);return s.useEffect(()=>{const c=o.current;if(c)return Vt(c)},[]),r.jsx(ye,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:x(e.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Wn=s.forwardRef((e,t)=>{const n=k(I,e.__scopeMenu);return r.jsx(ye,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Yn=En("MenuContent.ScrollLock"),ye=s.forwardRef((e,t)=>{const{__scopeMenu:n,loop:o=!1,trapFocus:a,onOpenAutoFocus:c,onCloseAutoFocus:l,disableOutsidePointerEvents:u,onEntryFocus:m,onEscapeKeyDown:f,onPointerDownOutside:d,onFocusOutside:i,onInteractOutside:h,onDismiss:w,disableOutsideScroll:v,...y}=e,g=k(I,n),M=Z(I,n),G=ae(n),_=Ke(n),N=$n(n),[K,Q]=s.useState(null),D=s.useRef(null),C=$(t,D,g.onContentChange),O=s.useRef(0),P=s.useRef(""),U=s.useRef(0),B=s.useRef(null),ee=s.useRef("right"),te=s.useRef(0),ie=v?Wt:s.Fragment,S=v?{as:Yn,allowPinchZoom:!0}:void 0,At=p=>{const L=P.current+p,T=N().filter(R=>!R.disabled),z=document.activeElement,ue=T.find(R=>R.ref.current===z)?.textValue,le=T.map(R=>R.textValue),Re=so(le,L,ue),V=T.find(R=>R.textValue===Re)?.ref.current;(function R(Ie){P.current=Ie,window.clearTimeout(O.current),Ie!==""&&(O.current=window.setTimeout(()=>R(""),1e3))})(L),V&&setTimeout(()=>V.focus())};s.useEffect(()=>()=>window.clearTimeout(O.current),[]),Ht();const F=s.useCallback(p=>ee.current===B.current?.side&&io(p,B.current?.area),[]);return r.jsx(Vn,{scope:n,searchRef:P,onItemEnter:s.useCallback(p=>{F(p)&&p.preventDefault()},[F]),onItemLeave:s.useCallback(p=>{F(p)||(D.current?.focus(),Q(null))},[F]),onTriggerLeave:s.useCallback(p=>{F(p)&&p.preventDefault()},[F]),pointerGraceTimerRef:U,onPointerGraceIntentChange:s.useCallback(p=>{B.current=p},[]),children:r.jsx(ie,{...S,children:r.jsx(Yt,{asChild:!0,trapped:a,onMountAutoFocus:x(c,p=>{p.preventDefault(),D.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:l,children:r.jsx($t,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:f,onPointerDownOutside:d,onFocusOutside:i,onInteractOutside:h,onDismiss:w,children:r.jsx(Nn,{asChild:!0,..._,dir:M.dir,orientation:"vertical",loop:o,currentTabStopId:K,onCurrentTabStopIdChange:Q,onEntryFocus:x(m,p=>{M.isUsingKeyboardRef.current||p.preventDefault()}),preventScrollOnEntryFocus:!0,children:r.jsx(Gt,{role:"menu","aria-orientation":"vertical","data-state":ct(g.open),"data-radix-menu-content":"",dir:M.dir,...G,...y,ref:C,style:{outline:"none",...y.style},onKeyDown:x(y.onKeyDown,p=>{const T=p.target.closest("[data-radix-menu-content]")===p.currentTarget,z=p.ctrlKey||p.altKey||p.metaKey,ue=p.key.length===1;T&&(p.key==="Tab"&&p.preventDefault(),!z&&ue&&At(p.key));const le=D.current;if(p.target!==le||!On.includes(p.key))return;p.preventDefault();const V=N().filter(R=>!R.disabled).map(R=>R.ref.current);$e.includes(p.key)&&V.reverse(),ro(V)}),onBlur:x(e.onBlur,p=>{p.currentTarget.contains(p.target)||(window.clearTimeout(O.current),P.current="")}),onPointerMove:x(e.onPointerMove,Y(p=>{const L=p.target,T=te.current!==p.clientX;if(p.currentTarget.contains(L)&&T){const z=p.clientX>te.current?"right":"left";ee.current=z,te.current=p.clientX}}))})})})})})})});Ve.displayName=I;var Xn="MenuGroup",Ce=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return r.jsx(E.div,{role:"group",...o,ref:t})});Ce.displayName=Xn;var qn="MenuLabel",He=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return r.jsx(E.div,{...o,ref:t})});He.displayName=qn;var ne="MenuItem",Se="menu.itemSelect",se=s.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:o,...a}=e,c=s.useRef(null),l=Z(ne,e.__scopeMenu),u=Me(ne,e.__scopeMenu),m=$(t,c),f=s.useRef(!1),d=()=>{const i=c.current;if(!n&&i){const h=new CustomEvent(Se,{bubbles:!0,cancelable:!0});i.addEventListener(Se,w=>o?.(w),{once:!0}),Lt(i,h),h.defaultPrevented?f.current=!1:l.onClose()}};return r.jsx(We,{...a,ref:m,disabled:n,onClick:x(e.onClick,d),onPointerDown:i=>{e.onPointerDown?.(i),f.current=!0},onPointerUp:x(e.onPointerUp,i=>{f.current||i.currentTarget?.click()}),onKeyDown:x(e.onKeyDown,i=>{const h=u.searchRef.current!=="";n||h&&i.key===" "||me.includes(i.key)&&(i.currentTarget.click(),i.preventDefault())})})});se.displayName=ne;var We=s.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:o=!1,textValue:a,...c}=e,l=Me(ne,n),u=Ke(n),m=s.useRef(null),f=$(t,m),[d,i]=s.useState(!1),[h,w]=s.useState("");return s.useEffect(()=>{const v=m.current;v&&w((v.textContent??"").trim())},[c.children]),r.jsx(W.ItemSlot,{scope:n,disabled:o,textValue:a??h,children:r.jsx(Sn,{asChild:!0,...u,focusable:!o,children:r.jsx(E.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...c,ref:f,onPointerMove:x(e.onPointerMove,Y(v=>{o?l.onItemLeave(v):(l.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:x(e.onPointerLeave,Y(v=>l.onItemLeave(v))),onFocus:x(e.onFocus,()=>i(!0)),onBlur:x(e.onBlur,()=>i(!1))})})})}),Jn="MenuCheckboxItem",Ye=s.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:o,...a}=e;return r.jsx(Qe,{scope:e.__scopeMenu,checked:n,children:r.jsx(se,{role:"menuitemcheckbox","aria-checked":oe(n)?"mixed":n,...a,ref:t,"data-state":_e(n),onSelect:x(a.onSelect,()=>o?.(oe(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Ye.displayName=Jn;var Xe="MenuRadioGroup",[Zn,Qn]=A(Xe,{value:void 0,onValueChange:()=>{}}),qe=s.forwardRef((e,t)=>{const{value:n,onValueChange:o,...a}=e,c=xe(o);return r.jsx(Zn,{scope:e.__scopeMenu,value:n,onValueChange:c,children:r.jsx(Ce,{...a,ref:t})})});qe.displayName=Xe;var Je="MenuRadioItem",Ze=s.forwardRef((e,t)=>{const{value:n,...o}=e,a=Qn(Je,e.__scopeMenu),c=n===a.value;return r.jsx(Qe,{scope:e.__scopeMenu,checked:c,children:r.jsx(se,{role:"menuitemradio","aria-checked":c,...o,ref:t,"data-state":_e(c),onSelect:x(o.onSelect,()=>a.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Ze.displayName=Je;var be="MenuItemIndicator",[Qe,eo]=A(be,{checked:!1}),et=s.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:o,...a}=e,c=eo(be,n);return r.jsx(re,{present:o||oe(c.checked)||c.checked===!0,children:r.jsx(E.span,{...a,ref:t,"data-state":_e(c.checked)})})});et.displayName=be;var to="MenuSeparator",tt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return r.jsx(E.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})});tt.displayName=to;var no="MenuArrow",nt=s.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,a=ae(n);return r.jsx(Kt,{...a,...o,ref:t})});nt.displayName=no;var oo="MenuSub",[ir,ot]=A(oo),H="MenuSubTrigger",rt=s.forwardRef((e,t)=>{const n=k(H,e.__scopeMenu),o=Z(H,e.__scopeMenu),a=ot(H,e.__scopeMenu),c=Me(H,e.__scopeMenu),l=s.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:m}=c,f={__scopeMenu:e.__scopeMenu},d=s.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return s.useEffect(()=>d,[d]),s.useEffect(()=>{const i=u.current;return()=>{window.clearTimeout(i),m(null)}},[u,m]),r.jsx(ge,{asChild:!0,...f,children:r.jsx(We,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":ct(n.open),...e,ref:ve(t,a.onTriggerChange),onClick:i=>{e.onClick?.(i),!(e.disabled||i.defaultPrevented)&&(i.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:x(e.onPointerMove,Y(i=>{c.onItemEnter(i),!i.defaultPrevented&&!e.disabled&&!n.open&&!l.current&&(c.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:x(e.onPointerLeave,Y(i=>{d();const h=n.content?.getBoundingClientRect();if(h){const w=n.content?.dataset.side,v=w==="right",y=v?-5:5,g=h[v?"left":"right"],M=h[v?"right":"left"];c.onPointerGraceIntentChange({area:[{x:i.clientX+y,y:i.clientY},{x:g,y:h.top},{x:M,y:h.top},{x:M,y:h.bottom},{x:g,y:h.bottom}],side:w}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>c.onPointerGraceIntentChange(null),300)}else{if(c.onTriggerLeave(i),i.defaultPrevented)return;c.onPointerGraceIntentChange(null)}})),onKeyDown:x(e.onKeyDown,i=>{const h=c.searchRef.current!=="";e.disabled||h&&i.key===" "||Fn[o.dir].includes(i.key)&&(n.onOpenChange(!0),n.content?.focus(),i.preventDefault())})})})});rt.displayName=H;var at="MenuSubContent",st=s.forwardRef((e,t)=>{const n=Be(I,e.__scopeMenu),{forceMount:o=n.forceMount,...a}=e,c=k(I,e.__scopeMenu),l=Z(I,e.__scopeMenu),u=ot(at,e.__scopeMenu),m=s.useRef(null),f=$(t,m);return r.jsx(W.Provider,{scope:e.__scopeMenu,children:r.jsx(re,{present:o||c.open,children:r.jsx(W.Slot,{scope:e.__scopeMenu,children:r.jsx(ye,{id:u.contentId,"aria-labelledby":u.triggerId,...a,ref:f,align:"start",side:l.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{l.isUsingKeyboardRef.current&&m.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:x(e.onFocusOutside,d=>{d.target!==u.trigger&&c.onOpenChange(!1)}),onEscapeKeyDown:x(e.onEscapeKeyDown,d=>{l.onClose(),d.preventDefault()}),onKeyDown:x(e.onKeyDown,d=>{const i=d.currentTarget.contains(d.target),h=Ln[l.dir].includes(d.key);i&&h&&(c.onOpenChange(!1),u.trigger?.focus(),d.preventDefault())})})})})})});st.displayName=at;function ct(e){return e?"open":"closed"}function oe(e){return e==="indeterminate"}function _e(e){return oe(e)?"indeterminate":e?"checked":"unchecked"}function ro(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function ao(e,t){return e.map((n,o)=>e[(t+o)%e.length])}function so(e,t,n){const a=t.length>1&&Array.from(t).every(f=>f===t[0])?t[0]:t,c=n?e.indexOf(n):-1;let l=ao(e,Math.max(c,0));a.length===1&&(l=l.filter(f=>f!==n));const m=l.find(f=>f.toLowerCase().startsWith(a.toLowerCase()));return m!==n?m:void 0}function co(e,t){const{x:n,y:o}=e;let a=!1;for(let c=0,l=t.length-1;c<t.length;l=c++){const u=t[c],m=t[l],f=u.x,d=u.y,i=m.x,h=m.y;d>o!=h>o&&n<(i-f)*(o-d)/(h-d)+f&&(a=!a)}return a}function io(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return co(n,t)}function Y(e){return t=>t.pointerType==="mouse"?e(t):void 0}var uo=Ue,lo=ge,fo=ze,po=Ve,mo=Ce,ho=He,xo=se,vo=Ye,go=qe,wo=Ze,Mo=et,yo=tt,Co=nt,bo=rt,_o=st,ce="DropdownMenu",[Ro]=he(ce,[Ge]),b=Ge(),[Io,it]=Ro(ce),ut=e=>{const{__scopeDropdownMenu:t,children:n,dir:o,open:a,defaultOpen:c,onOpenChange:l,modal:u=!0}=e,m=b(t),f=s.useRef(null),[d,i]=je({prop:a,defaultProp:c??!1,onChange:l,caller:ce});return r.jsx(Io,{scope:t,triggerId:fe(),triggerRef:f,contentId:fe(),open:d,onOpenChange:i,onOpenToggle:s.useCallback(()=>i(h=>!h),[i]),modal:u,children:r.jsx(uo,{...m,open:d,onOpenChange:i,dir:o,modal:u,children:n})})};ut.displayName=ce;var lt="DropdownMenuTrigger",dt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:o=!1,...a}=e,c=it(lt,n),l=b(n);return r.jsx(lo,{asChild:!0,...l,children:r.jsx(E.button,{type:"button",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":c.open?c.contentId:void 0,"data-state":c.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...a,ref:ve(t,c.triggerRef),onPointerDown:x(e.onPointerDown,u=>{!o&&u.button===0&&u.ctrlKey===!1&&(c.onOpenToggle(),c.open||u.preventDefault())}),onKeyDown:x(e.onKeyDown,u=>{o||(["Enter"," "].includes(u.key)&&c.onOpenToggle(),u.key==="ArrowDown"&&c.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(u.key)&&u.preventDefault())})})})});dt.displayName=lt;var No="DropdownMenuPortal",ft=e=>{const{__scopeDropdownMenu:t,...n}=e,o=b(t);return r.jsx(fo,{...o,...n})};ft.displayName=No;var pt="DropdownMenuContent",mt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=it(pt,n),c=b(n),l=s.useRef(!1);return r.jsx(po,{id:a.contentId,"aria-labelledby":a.triggerId,...c,...o,ref:t,onCloseAutoFocus:x(e.onCloseAutoFocus,u=>{l.current||a.triggerRef.current?.focus(),l.current=!1,u.preventDefault()}),onInteractOutside:x(e.onInteractOutside,u=>{const m=u.detail.originalEvent,f=m.button===0&&m.ctrlKey===!0,d=m.button===2||f;(!a.modal||d)&&(l.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});mt.displayName=pt;var So="DropdownMenuGroup",Eo=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(mo,{...a,...o,ref:t})});Eo.displayName=So;var jo="DropdownMenuLabel",ht=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(ho,{...a,...o,ref:t})});ht.displayName=jo;var Do="DropdownMenuItem",xt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(xo,{...a,...o,ref:t})});xt.displayName=Do;var Po="DropdownMenuCheckboxItem",vt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(vo,{...a,...o,ref:t})});vt.displayName=Po;var To="DropdownMenuRadioGroup",Ao=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(go,{...a,...o,ref:t})});Ao.displayName=To;var ko="DropdownMenuRadioItem",gt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(wo,{...a,...o,ref:t})});gt.displayName=ko;var Oo="DropdownMenuItemIndicator",wt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(Mo,{...a,...o,ref:t})});wt.displayName=Oo;var Fo="DropdownMenuSeparator",Mt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(yo,{...a,...o,ref:t})});Mt.displayName=Fo;var Lo="DropdownMenuArrow",$o=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(Co,{...a,...o,ref:t})});$o.displayName=Lo;var Go="DropdownMenuSubTrigger",yt=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(bo,{...a,...o,ref:t})});yt.displayName=Go;var Ko="DropdownMenuSubContent",Ct=s.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,a=b(n);return r.jsx(_o,{...a,...o,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ct.displayName=Ko;var Uo=ut,Bo=dt,zo=ft,bt=mt,_t=ht,Rt=xt,It=vt,Nt=gt,St=wt,Et=Mt,jt=yt,Dt=Ct;const Vo=Uo,Ho=Bo,Wo=s.forwardRef(({className:e,inset:t,children:n,...o},a)=>r.jsxs(jt,{ref:a,className:j("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...o,children:[n,r.jsx(rn,{className:"ml-auto h-4 w-4"})]}));Wo.displayName=jt.displayName;const Yo=s.forwardRef(({className:e,...t},n)=>r.jsx(Dt,{ref:n,className:j("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));Yo.displayName=Dt.displayName;const Pt=s.forwardRef(({className:e,sideOffset:t=4,...n},o)=>r.jsx(zo,{children:r.jsx(bt,{ref:o,sideOffset:t,className:j("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Pt.displayName=bt.displayName;const Tt=s.forwardRef(({className:e,inset:t,...n},o)=>r.jsx(Rt,{ref:o,className:j("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...n}));Tt.displayName=Rt.displayName;const Xo=s.forwardRef(({className:e,children:t,checked:n,...o},a)=>r.jsxs(It,{ref:a,className:j("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...o,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(St,{children:r.jsx(nn,{className:"h-4 w-4"})})}),t]}));Xo.displayName=It.displayName;const qo=s.forwardRef(({className:e,children:t,...n},o)=>r.jsxs(Nt,{ref:o,className:j("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(St,{children:r.jsx(sn,{className:"h-2 w-2 fill-current"})})}),t]}));qo.displayName=Nt.displayName;const Jo=s.forwardRef(({className:e,inset:t,...n},o)=>r.jsx(_t,{ref:o,className:j("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));Jo.displayName=_t.displayName;const Zo=s.forwardRef(({className:e,...t},n)=>r.jsx(Et,{ref:n,className:j("-mx-1 my-1 h-px bg-muted",e),...t}));Zo.displayName=Et.displayName;const Qo=s.lazy(()=>Ut(()=>import("./Comments-DwdjivDr.js"),__vite__mapDeps([0,1,2,3,4])));function er(e){const t=n=>{const o=String(n||"");if(!o)return o;const a=o.startsWith("//")?`https:${o}`:o;return/^https:\/\//i.test(a)?a:/^http:\/\//i.test(a)?`/api/proxy?url=${encodeURIComponent(a)}`:a};return e.replace(/(\s(?:src|poster)\s*=\s*")([^"]*)(")/gi,(n,o,a,c)=>`${o}${t(a)}${c}`)}const tr=s.memo(({src:e,alt:t})=>{const[n,o]=s.useState(!1);return r.jsx("img",{src:e,alt:t,className:"max-w-full h-auto",loading:"lazy",onLoad:()=>o(!0),style:{opacity:n?1:.7,transition:"opacity 0.3s"}})}),nr=s.memo(({src:e})=>r.jsx("video",{src:e,controls:!0,className:"w-full h-auto",loading:"lazy",preload:"metadata"}));function or({post:e,deleted:t,setDeleted:n,onComments:o,onShare:a}){const c=async()=>{const u=`${window.location.href.split("#")[0]}#post-${e.id}`;try{navigator.share?await navigator.share({title:"Post",url:u}):(await navigator.clipboard.writeText(u),alert("Link copied"))}catch{}};return t?null:r.jsxs("article",{id:`post-${e.id}`,className:"rounded-xl border bg-card overflow-visible",children:[r.jsxs("header",{className:"flex items-center justify-between p-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ne,{to:e.author.id?`/u/${e.author.id}`:"/profile",className:"rounded-full",children:r.jsxs(Xt,{className:"h-10 w-10",children:[r.jsx(qt,{src:e.author.avatar,alt:e.author.name}),r.jsx(Jt,{children:e.author.name[0]})]})}),r.jsxs("div",{className:"leading-tight",children:[r.jsx(Ne,{to:e.author.id?`/u/${e.author.id}`:"/profile",className:"font-semibold hover:underline",children:e.author.name}),r.jsx("p",{className:"text-xs text-muted-foreground",children:e.createdAt})]})]}),r.jsx("div",{children:r.jsxs(Vo,{children:[r.jsx(Ho,{asChild:!0,children:r.jsx("button",{className:"rounded-full p-2 hover:bg-muted/60",children:r.jsx(Zt,{className:"size-5 text-muted-foreground"})})}),r.jsx(Pt,{align:"end",children:e.author.id&&Bt()?.id===e.author.id?r.jsxs(Tt,{className:"text-red-600",onClick:async()=>{if(confirm("Delete this post?"))try{(await fetch(`/api/posts/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${zt()}`}})).ok&&(n(!0),window.dispatchEvent(new Event("feed:refresh")),window.dispatchEvent(new CustomEvent("post:deleted",{detail:{id:e.id}})))}catch{}},children:[r.jsx(dn,{className:"size-4 mr-2"})," Delete"]}):null})]})})]}),e.mode==="html"?r.jsx("div",{className:"px-3 pb-3 text-sm prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:er(e.content)}}):r.jsx("div",{className:"px-3 pb-3 text-sm whitespace-pre-wrap",children:e.content}),e.image&&r.jsx(tr,{src:e.image,alt:""}),e.video&&r.jsx(nr,{src:e.video}),e.monetized?r.jsx(hn,{}):null,r.jsxs("div",{className:"px-3 py-2 text-xs text-muted-foreground flex items-center gap-4",children:[r.jsxs("span",{children:[e.likes," reactions"]}),r.jsxs("span",{children:[e.comments," comments"]}),r.jsxs("span",{children:[e.shares," shares"]})]}),r.jsxs("div",{className:"grid grid-cols-3 divide-x border-t text-sm",children:[r.jsx(mn,{postId:e.id,initialCount:e.likes}),r.jsxs("button",{className:"flex items-center justify-center gap-2 py-2.5 hover:bg-muted/60",onClick:()=>o(!o),children:[r.jsx(Qt,{className:"size-5"})," Comment"]}),r.jsxs("button",{className:"flex items-center justify-center gap-2 py-2.5 hover:bg-muted/60",onClick:c,children:[r.jsx(un,{className:"size-5"})," Share"]})]})]})}const rr=s.memo(or,(e,t)=>e.post.id===t.post.id&&e.post.likes===t.post.likes&&e.post.comments===t.post.comments&&e.deleted===t.deleted),ur=s.memo(function({post:t}){const[n,o]=s.useState(!1),[a,c]=s.useState(!1);return r.jsxs(r.Fragment,{children:[r.jsx(rr,{post:t,deleted:a,setDeleted:c,onComments:n}),n&&r.jsx(s.Suspense,{fallback:r.jsx("div",{className:"p-4",children:"Loading comments..."}),children:r.jsx(Qo,{postId:t.id})})]})});export{ur as P};
