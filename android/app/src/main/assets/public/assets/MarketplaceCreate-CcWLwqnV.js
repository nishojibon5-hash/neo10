import{r as g,j as e,f as x,k as f}from"./index-Cny3-YC3.js";import{L as h}from"./Layout-63m88gTv.js";import{I as r,B as b}from"./button-vWn4QgZQ.js";import{u as j}from"./index.esm-0Fh_zl6_.js";import{u as y}from"./upload-Bx7WDt3n.js";const l=g.forwardRef(({className:o,...i},a)=>e.jsx("textarea",{className:x("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o),ref:a,...i}));l.displayName="Textarea";function T(){const{register:o,handleSubmit:i,setValue:a,watch:p}=j(),d=f(),s=p("image"),m=async t=>{let c;t.image&&t.image[0]&&(c=await y(t.image[0]));const u={title:t.title,description:t.description,price:t.price?Number(t.price):void 0,image_url:c,location:t.location,category:t.category,contact_phone:t.contact_phone},n=localStorage.getItem("token")||"";(await fetch("/api/market/listings",{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify(u)})).ok?d("/marketplace"):alert("Failed to create listing")};return e.jsx(h,{children:e.jsxs("div",{className:"mx-auto max-w-2xl",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Create Listing"}),e.jsxs("form",{className:"space-y-3",onSubmit:i(m),children:[e.jsx(r,{placeholder:"Title",...o("title",{required:!0})}),e.jsx(r,{type:"number",step:"1",placeholder:"Price (optional)",...o("price")}),e.jsx(r,{placeholder:"Location",...o("location")}),e.jsx(r,{placeholder:"Category",...o("category")}),e.jsx(r,{placeholder:"Contact phone",...o("contact_phone")}),e.jsx(l,{rows:5,placeholder:"Description",...o("description",{required:!0})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:t=>a("image",t.target.files)}),s&&s[0]&&e.jsx("img",{src:URL.createObjectURL(s[0]),alt:"preview",className:"mt-2 h-32 object-cover rounded"})]}),e.jsx(b,{type:"submit",children:"Publish"})]})]})})}export{T as default};
