import{j as e,g as y,s as b}from"./index-Cny3-YC3.js";import{L as N}from"./Layout-63m88gTv.js";import{I as l,B as w}from"./button-vWn4QgZQ.js";import{u as _}from"./index.esm-0Fh_zl6_.js";import{u as f}from"./upload-Bx7WDt3n.js";function B(){const{register:t,handleSubmit:x,setValue:c,watch:i}=_(),v=async r=>{try{const a={};["name","username","avatar_url","cover_url","bio"].forEach(d=>{const h=r[d];if(typeof h=="string"){const p=h.trim();p&&(a[d]=p)}});const s=y(),o=await fetch("/api/users/me",{method:"PATCH",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}},body:JSON.stringify(a)}),m=await o.json().catch(()=>({}));if(o.status===401){alert("Please login"),window.location.href="/login";return}o.ok?(b(m.user),alert("Save success")):alert(m.error||"Failed")}catch(a){alert(a?.message||"Failed")}},n=i("avatar_url"),u=i("cover_url"),g=async r=>{const a=r.target.files?.[0];if(a)try{const s=await f(a);c("avatar_url",s,{shouldDirty:!0,shouldTouch:!0})}catch(s){alert(s?.message||"Avatar upload failed")}},j=async r=>{const a=r.target.files?.[0];if(a)try{const s=await f(a);c("cover_url",s,{shouldDirty:!0,shouldTouch:!0})}catch(s){alert(s?.message||"Cover upload failed")}};return e.jsx(N,{children:e.jsxs("div",{className:"mx-auto max-w-xl rounded-xl border bg-card p-6 space-y-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Edit Profile"}),e.jsxs("form",{onSubmit:x(v),className:"space-y-3",children:[e.jsx(l,{placeholder:"Name",...t("name")}),e.jsx(l,{placeholder:"Username",...t("username")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{placeholder:"Avatar URL",...t("avatar_url")}),e.jsx("label",{className:"inline-flex items-center gap-2 text-sm",children:e.jsx("input",{type:"file",accept:"image/*",onChange:g})})]}),n?e.jsx("img",{src:n,alt:"avatar",className:"h-20 w-20 rounded-full object-cover"}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{placeholder:"Cover URL",...t("cover_url")}),e.jsx("label",{className:"inline-flex items-center gap-2 text-sm",children:e.jsx("input",{type:"file",accept:"image/*",onChange:j})})]}),u?e.jsx("img",{src:u,alt:"cover",className:"h-24 w-full object-cover rounded"}):null]}),e.jsx("textarea",{placeholder:"Bio",...t("bio"),className:"min-h-24 w-full rounded-md border bg-background p-2 text-sm"}),e.jsx(w,{type:"submit",className:"w-full",children:"Save changes"})]})]})})}export{B as default};
