import{r as a,j as s}from"./index-Cny3-YC3.js";import{A as h,a as p,b as x}from"./Layout-63m88gTv.js";import{B as y}from"./button-vWn4QgZQ.js";function A({postId:o}){const[f,g]=a.useState([]),[n,c]=a.useState(""),[l,j]=a.useState([]),[v,m]=a.useState(!1),d=async()=>{const e=await fetch(`/api/posts/${o}/comments`).catch(()=>null),t=e&&e.ok?await e.json():{comments:[]};g(t.comments||[])};a.useEffect(()=>{d()},[o]),a.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("token")||"",t=await fetch("/api/friends/suggestions",{headers:{Authorization:e?`Bearer ${e}`:""}}),r=t.ok?await t.json():{users:[]};j(r.users||[])}catch{}})()},[]);const i=a.useMemo(()=>{const e=n.match(/(^|\s)@([A-Za-z0-9_]{1,20})$/);return e?e[2].toLowerCase():""},[n]),u=a.useMemo(()=>i?l.filter(e=>e.name.toLowerCase().includes(i)).slice(0,5):[],[i,l]),w=e=>{c(t=>t.replace(/(@[A-Za-z0-9_]{0,20})$/,`@${e} `)),m(!1)},b=async()=>{const e=n.trim();if(e)try{const t=localStorage.getItem("token")||"",r=await fetch(`/api/posts/${o}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({content:e})});if(r.status===401){window.location.href="/login";return}r.ok&&(c(""),d())}catch{}};return s.jsxs("div",{className:"border-t p-3 space-y-3",children:[s.jsx("div",{className:"space-y-3",children:f.map(e=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsxs(h,{className:"h-7 w-7",children:[s.jsx(p,{src:e.user_avatar||"https://i.pravatar.cc/100"}),s.jsx(x,{children:e.user_name?.[0]||"U"})]}),s.jsxs("div",{className:"rounded-lg bg-muted/50 px-3 py-2 text-sm",children:[s.jsx("div",{className:"font-medium",children:e.user_name}),s.jsx("div",{className:"whitespace-pre-wrap",children:e.content})]})]},e.id))}),s.jsxs("div",{className:"relative flex items-center gap-2",children:[s.jsx("input",{value:n,onChange:e=>{c(e.target.value),m(!0)},placeholder:"Write a comment...",className:"flex-1 h-9 rounded-full border bg-background px-3 text-sm"}),s.jsx(y,{size:"sm",onClick:b,children:"Post"}),v&&u.length>0&&s.jsx("div",{className:"absolute bottom-10 left-3 z-20 rounded-md border bg-card shadow w-56",children:u.map(e=>s.jsxs("button",{onClick:()=>w(e.name),className:"w-full flex items-center gap-2 px-2 py-1.5 hover:bg-muted/60 text-sm",children:[s.jsxs(h,{className:"h-6 w-6",children:[s.jsx(p,{src:e.avatar_url||""}),s.jsx(x,{children:e.name[0]})]}),s.jsx("span",{children:e.name})]},e.id))})]})]})}export{A as default};
