import{r as _,j as e,g as N}from"./index-Cny3-YC3.js";import{L as S}from"./Layout-63m88gTv.js";import{I as i,B as w}from"./button-vWn4QgZQ.js";import{u as A}from"./index.esm-0Fh_zl6_.js";import{u as v}from"./upload-Bx7WDt3n.js";function D(){const{register:a,handleSubmit:x,setValue:m,watch:o}=A({defaultValues:{trial:!0}}),[u,p]=_.useState(!1),d=o("media_url"),y=o("media_type"),h=o("trial"),g=o("end_at"),f=async t=>{const s=t.target.files?.[0];if(!s)return;const n=await v(s);m("media_url",n),m("media_type",s.type.startsWith("video")?"video":"image")},j=async t=>{try{p(!0);const s=r=>r==null||String(r).trim()===""?void 0:r,n=r=>r&&String(r).trim()?new Date(r).toISOString():void 0,b={title:t.title,destination_url:s(t.destination_url),media_url:s(t.media_url),media_type:s(t.media_type),locations:s(t.locations),audience:s(t.audience),budget:typeof t.budget=="number"&&isFinite(t.budget)?t.budget:void 0,start_at:n(t.start_at),end_at:n(t.end_at),trial:!!t.trial,payment_method:t.trial?void 0:s(t.payment_method),transaction_id:t.trial?void 0:s(t.transaction_id)},l=await fetch("/api/ads",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N()}`},body:JSON.stringify(b)}),c=await l.json().catch(()=>({}));if(l.status===401){alert("Please login"),window.location.href="/login";return}l.ok?alert("Ad created. Status: "+c.status):alert(c.error?JSON.stringify(c.error):"Failed")}finally{p(!1)}};return e.jsx(S,{children:e.jsxs("div",{className:"mx-auto max-w-2xl rounded-xl border bg-card p-6 space-y-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Create Ads"}),e.jsxs("form",{onSubmit:x(j),className:"space-y-3",children:[e.jsx(i,{placeholder:"Ad title",...a("title",{required:!0})}),e.jsx(i,{placeholder:"Destination URL (optional)",...a("destination_url")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{placeholder:"Media URL",...a("media_url")}),e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:f})]}),d?y==="video"?e.jsx("video",{src:d,className:"w-full h-auto rounded",controls:!0}):e.jsx("img",{src:d,className:"w-full h-auto rounded"}):null]}),e.jsx(i,{placeholder:"Locations (e.g. Dhaka, Chittagong)",...a("locations")}),e.jsx(i,{placeholder:"Audience (interests, keywords)",...a("audience")}),e.jsx(i,{type:"number",step:"0.01",placeholder:"Budget (optional)",...a("budget",{valueAsNumber:!0})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(i,{type:"datetime-local",placeholder:"Start at",...a("start_at")}),e.jsx(i,{type:"datetime-local",placeholder:"End at",...a("end_at")})]}),e.jsxs("div",{className:"rounded-md border p-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium",children:"2-day free trial"}),e.jsx("input",{type:"checkbox",...a("trial")})]}),e.jsx("p",{className:"text-muted-foreground",children:"If enabled, your ad goes live instantly for 2 days. To run longer than 2 days, complete payment below."}),!h&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Payment (bKash/Nagad)"}),e.jsx("p",{className:"text-muted-foreground",children:"Pay to 01650074073 (personal). After payment, enter method and transaction ID to activate."}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(i,{placeholder:"Method (bKash/Nagad)",...a("payment_method")}),e.jsx(i,{placeholder:"Transaction ID",...a("transaction_id")})]})]}),h&&g?e.jsx("p",{className:"text-xs text-amber-600",children:"Note: Trial serves only until 2 days from now, regardless of End at."}):null]}),e.jsx(w,{type:"submit",disabled:u,className:"w-full",children:u?"Submitting...":"Submit"})]})]})})}export{D as default};
