import{l as p,r as o,j as e,L as x,g as j}from"./index-Cny3-YC3.js";import{L as g}from"./Layout-63m88gTv.js";import{P as v}from"./PostCard-CWJJR5AN.js";import{B as m}from"./button-vWn4QgZQ.js";function b({userId:a}){const[s,i]=o.useState("idle"),c=async()=>{if(s==="idle")try{const n=j(),d=await fetch(`/api/users/${a}/follow`,{method:"POST",headers:{Authorization:n?`Bearer ${n}`:""}});if(d.status===401){window.location.href="/login";return}d.ok&&i("pending")}catch{}};return e.jsx(m,{onClick:c,disabled:s!=="idle",children:s==="pending"?"Requested":"Follow"})}function _(){const{id:a}=p(),[s,i]=o.useState(null),[c,n]=o.useState([]),[d,f]=o.useState(!1);return o.useEffect(()=>{(async()=>{try{const r=await fetch(`/api/users/${a}`);if(r.ok){const u=await r.json();i(u.user)}const l=await fetch(`/api/users/${a}/posts`);if(l.ok){const h=((await l.json()).posts||[]).map(t=>({id:t.id,author:{id:t.user_id,name:t.user_name,avatar:t.user_avatar},content:t.content||"",mode:t.content_mode==="html"?"html":"text",image:t.image_url||void 0,video:t.video_url||void 0,createdAt:new Date(t.created_at).toLocaleString(),likes:0,comments:0,shares:0}));n(h)}}finally{f(!0)}})()},[a]),e.jsx(g,{children:!s&&d?e.jsx("div",{className:"rounded-xl border bg-card p-8",children:"User not found"}):s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl border overflow-hidden",children:[e.jsx("div",{className:"h-48 w-full bg-cover bg-center",style:{backgroundImage:`url(${s.cover_url||""})`}}),e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsx("img",{src:s.avatar_url||"https://i.pravatar.cc/100",className:"h-20 w-20 rounded-full border-4 border-card -mt-12 bg-muted object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-bold",children:[s.name," ",s.username&&e.jsxs("span",{className:"text-muted-foreground text-sm",children:["@",s.username]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bio||"â€”"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{asChild:!0,variant:"secondary",children:e.jsx(x,{to:`/messages?user=${a}`,children:"Message"})}),e.jsx(b,{userId:String(a)})]})]})]}),e.jsx("section",{className:"space-y-4",children:c.map(r=>e.jsx(v,{post:r},r.id))})]}):e.jsx("div",{className:"rounded-xl border bg-card p-8",children:"Loading..."})})}export{_ as default};
